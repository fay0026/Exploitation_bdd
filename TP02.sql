--FAY Damien INF-S2 TP5B

--R11
SELECT  COUNT(E.cdemp) AS "Nb employés",
        COUNT(E.datdpt) AS "Nb Partis",
        COUNT(E.cdemp) - COUNT(E.datdpt) AS "Nb Présents",
        COUNT(E.datemb) AS "Nb Titulaires",
        COUNT(DISTINCT E.qualif) AS "Nb qualifs"
FROM    LOCVEC.EMPLOYE E;

--R12
SELECT  SUM(E.salaire) AS "Somme salaire",
        ROUND(AVG(E.salaire), 2) AS "Moyenne salaire",
        ROUND(MAX(E.salaire), 2) AS "Salaire Max"
FROM    LOCVEC.EMPLOYE E
WHERE   E.datemb IS NOT NULL;

--R13
SELECT  ROUND(MAX(E.salaire), 2) AS "Salaire Maxi"
FROM    LOCVEC.EMPLOYE E;

--R14
SELECT  E.nom||' -'||E.prnm AS "Employé le mieux payé",
        E.qualif AS Qualification,
        E.salaire AS SALAIRE
FROM    LOCVEC.EMPLOYE E
WHERE   E.salaire = (SELECT  MAX(salaire)
                      FROM    LOCVEC.EMPLOYE);
                    
--R15
SELECT  MO.marque||' '||MO.tpmdl AS Modèle,
        VE.imtrcl AS Immatriculation
FROM    LOCVEC.VEHICULE VE
        INNER JOIN LOCVEC.MODELE MO ON (VE.cdmdl = MO.cdmdl)
WHERE   VE.kmactl = (SELECT    MAX(kmactl)
                      FROM      LOCVEC.VEHICULE
                      WHERE     TO_CHAR(datpmc, 'YYYY') = '2005')
        AND TO_CHAR(datpmc, 'YYYY') = '2005';

--R16
SELECT  C.nom||' '||C.prnm AS Client,
        TPCTR.inttpctr AS "Type contrat",
        MO.marque||' '||MO.tpmdl AS Modèle,
        V.imtrcl AS Immatriculation,
        (CTR.kmrtr-CTR.kmdpt) AS "Nb km parcourus"
FROM    LOCVEC.Client C
        INNER JOIN LOCVEC.CONTRAT CTR ON (C.cdcli = CTR.cdcli)
        INNER JOIN LOCVEC.TYPECONTRAT TPCTR ON (CTR.cdtpctr = TPCTR.cdtpctr)
        INNER JOIN LOCVEC.VEHICULE V ON (CTR.cdvhc = V.cdvhc)
        INNER JOIN LOCVEC.MODELE MO ON (V.cdmdl = MO.cdmdl)
WHERE   (CTR.kmrtr-CTR.kmdpt) IN (SELECT    MAX(CTR.kmrtr-CTR.kmdpt)
                                  FROM      LOCVEC.CONTRAT CTR
                                            INNER JOIN LOCVEC.TYPECONTRAT TPCTR ON (CTR.cdtpctr = TPCTR.cdtpctr)
                                  WHERE     UPPER(TPCTR.inttpctr) LIKE '%SEMAINE%')
        AND UPPER(TPCTR.inttpctr) LIKE '%SEMAINE%';

--R17
SELECT  qualif AS Qualification,
        COUNT(cdemp) AS "Nb Employés",
        AVG(salaire) AS "Salaire Moyen"
FROM    LOCVEC.EMPLOYE
GROUP   BY qualif
ORDER   BY Qualification;

--R18
SELECT  E.nom||' '||E.prnm AS Employé,
        TPCTR.inttpctr AS "Type contrat",
        COUNT(CTR.cdemp) AS "Nb Contrats"
FROM    LOCVEC.EMPLOYE E
        INNER JOIN LOCVEC.CONTRAT CTR ON (E.cdemp = CTR.cdemp)
        INNER JOIN LOCVEC.TYPECONTRAT TPCTR ON (CTR.cdtpctr = TPCTR.cdtpctr)
GROUP   BY E.nom, E.prnm, TPCTR.inttpctr
ORDER   BY Employé, "Nb Contrats" DESC;

--R19
SELECT  CTG.intctg as "Catégorie",
        DECODE(tpvhc, 1, 'Tourisme', 2, 'Utilitaire', 3, 'Exception') AS Type,
        COUNT(MO.cdmdl) AS "Nb Modèles"
FROM    LOCVEC.CATEGORIE CTG
        INNER JOIN LOCVEC.MODELE MO ON (CTG.cdctg = MO.cdctg)
WHERE   Mo.Marque IN ('OPEL','RENAULT','PEUGEOT')
GROUP   BY CTG.intctg, tpvhc
ORDER   BY "Nb Modèles" DESC;




