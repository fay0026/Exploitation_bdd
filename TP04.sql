--FAY Damien INF-S2 TP5B

--R30

--a UNION

SELECT  nom||' '||prnm AS Client,
        prfs AS Profession
FROM    LOCVEC.CLIENT
WHERE   prfs =    (SELECT   prfs
                   FROM     LOCVEC.CLIENT
                   WHERE    UPPER(nom||' '||prnm) = 'LECOMTE MARCELLE')
UNION
SELECT  nom||' '||prnm ,
        'PAS DE PROFESSION' 
FROM    LOCVEC.CLIENT
WHERE   prfs is null
ORDER   BY 1;

--b NVL

SELECT  C.nom||' '||C.prnm AS Client,
        NVL(C.prfs,'PAS de PROFESSION') AS Profession
FROM    LOCVEC.CLIENT C
        INNER JOIN LOCVEC.CLIENT C2 ON (C.prfs = C2.prfs OR C.prfs is null)
WHERE   UPPER(C2.nom||' '||C2.prnm) = 'LECOMTE MARCELLE'
ORDER   BY C.nom;
                   
--R31

SELECT  nom||'-'||prnm AS Personne,
        datns AS "Date de naissance",
        prfs AS profession,
        'CLIENT' AS Statut
FROM    LOCVEC.CLIENT
WHERE   TO_CHAR(datns, 'YYYY') < 1960
UNION
SELECT  nom||'-'||prnm,
        datns,
        qualif,
        'EMPLOYE'
FROM    LOCVEC.EMPLOYE
WHERE   TO_CHAR(datns, 'YYYY') < 1960
ORDER   BY profession, "Date de naissance";
                   
--R32

SELECT  MO.marque||' '||MO.tpmdl AS Modèle,
        CTG.intctg AS Catégorie
FROM    LOCVEC.MODELE MO
        INNER JOIN LOCVEC.CATEGORIE CTG ON (MO.cdctg = CTG.cdctg)
 MINUS
SELECT  MO.marque||' '||MO.tpmdl ,
        CTG.intctg 
FROM    LOCVEC.MODELE MO
        INNER JOIN LOCVEC.CATEGORIE CTG ON (MO.cdctg = CTG.cdctg)
        INNER JOIN LOCVEC.VEHICULE VE ON (MO.cdmdl = VE.cdmdl);
                   
--R33

--a JOINTURE
                   
SELECT  E.nom||' '||E.prnm AS Employé
FROM    LOCVEC.EMPLOYE E
        LEFT JOIN LOCVEC.CONTRAT CT ON (E.cdemp = CT.cdemp)
WHERE   CT.CDCTR is null
        AND upper(E.qualif) = 'COMMERCIAL';
                   
--b SOUS-REQUÊTE

SELECT  nom||' '||prnm AS Employé
FROM    LOCVEC.EMPLOYE
WHERE   qualif = 'COMMERCIAL'
        AND cdemp NOT IN (SELECT  cdemp
                            FROM    LOCVEC.CONTRAT);

--c OPÉRATEUR D'ENSEMBLE

SELECT  nom||' '||prnm AS Employé
FROM    LOCVEC.EMPLOYE
WHERE   qualif = 'COMMERCIAL'
MINUS
SELECT  nom||' '||prnm
FROM    LOCVEC.CONTRAT co
        INNER JOIN LOCVEC.EMPLOYE E ON (co.cdemp = E.cdemp);

--R34

SELECT  DISTINCT prfs AS Profession
FROM    LOCVEC.CLIENT
WHERE   prfs IN (SELECT Qualif
                 FROM   LOCVEC.EMPLOYE);
                 
--INTERSECT
                 
SELECT  prfs AS Profession
FROM    LOCVEC.CLIENT
INTERSECT
SELECT  Qualif
FROM    LOCVEC.EMPLOYE;

--R35

SELECT  TPCTR.inttpctr AS "Type de Contrat",
        'Tarif Base' AS "Type de tarif",
        TAR.tarif_base AS "Tarif"
FROM    LOCVEC.TYPECONTRAT TPCTR
        INNER JOIN LOCVEC.TARIF TAR ON (TPCTR.CDTPCTR = TAR.CDTPCTR)
        INNER JOIN LOCVEC.CATEGORIE CTG ON (TAR.CDCTG = CTG.CDCTG)
WHERE   UPPER(CTG.cdctg) = 'A'
UNION
SELECT  TPCTR.inttpctr,
        'Tarif Km',
        TAR.tarif_km
FROM    LOCVEC.TYPECONTRAT TPCTR
        INNER JOIN LOCVEC.TARIF TAR ON (TPCTR.CDTPCTR = TAR.CDTPCTR)
        INNER JOIN LOCVEC.CATEGORIE CTG ON (TAR.CDCTG = CTG.CDCTG)
WHERE   UPPER(CTG.cdctg) = 'A'
UNION
SELECT  TPCTR.inttpctr,
        'Tarif Options',
        (tarif_ca + tarif_arf + tarif_atm)
FROM    LOCVEC.TYPECONTRAT TPCTR
        INNER JOIN LOCVEC.TARIF TAR ON (TPCTR.CDTPCTR = TAR.CDTPCTR)
        INNER JOIN LOCVEC.CATEGORIE CTG ON (TAR.CDCTG = CTG.CDCTG)
WHERE   UPPER(CTG.cdctg) = 'A';

--R36

--a JOINTURE

SELECT  MO.marque||' '||MO.tpmdl AS Modèle
FROM    LOCVEC.MODELE MO
        INNER JOIN LOCVEC.MODELE MO2 ON (MO.cdctg = MO2.cdctg)
        INNER JOIN LOCVEC.MODELE MO3 ON (MO.cdctg = MO3.cdctg)
WHERE   UPPER(MO2.marque) = 'RENAULT'
        AND UPPER(MO3.tpmdl) = 'CLIO';

--b SOUS-REQUÊTE

SELECT  marque||' '||tpmdl AS Modèle
FROM    LOCVEC.MODELE
WHERE   cdctg IN   (SELECT  cdctg
                    FROM    LOCVEC.MODELE
                    WHERE   UPPER(marque) = 'RENAULT'
                            AND UPPER(tpmdl) = 'CLIO');
                                    
--c SYNCHRONISÉE (RETIRER LA RENAULT CLIO)

SELECT  MO.marque||' '||MO.tpmdl AS Modèle
FROM    LOCVEC.MODELE MO
WHERE   MO.cdctg = (SELECT  cdctg
                    FROM    LOCVEC.MODELE
                    WHERE   UPPER(marque) = 'RENAULT'
                            AND UPPER(tpmdl) = 'CLIO'
                            AND MO.cdmdl <> cdmdl);
                                        
--R37

SELECT  CL.nom||' '||CL.prnm AS Client
FROM    LOCVEC.CLIENT CL
WHERE   (CL.prfs, CL.localite) =   (SELECT  prfs,
                                            localite
                                    FROM    LOCVEC.CLIENT
                                    WHERE   nom||' '||prnm = 'LECOMTE Marcelle'
                                            AND CL.cdcli <> cdcli);

