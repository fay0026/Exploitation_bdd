--FAY Damien INF-S2 TP5B

--R38

SELECT  E.prnm||' '||E.nom AS Employe
FROM    LOCVEC.EMPLOYE E
WHERE   TO_CHAR(E.datemb, 'YYYY') =    (SELECT  TO_CHAR(datemb, 'YYYY')
                                        FROM    LOCVEC.EMPLOYE
                                        WHERE   E.cdsup = cdemp);

--R39

SELECT  E.qualif AS Qualification,
		E.nom||' '||E.prnm AS Employé,
		E.salaire AS Salaire
FROM    LOCVEC.EMPLOYE E
WHERE   E.salaire =    (SELECT  MAX(salaire)
                        FROM	LOCVEC.EMPLOYE
                        WHERE	E.qualif = qualif)
ORDER   BY E.salaire DESC;


--R40

--a (JOINTURE)

SELECT	DISTINCT E.nom||' '||E.prnm AS Employé,
		E.qualif AS Qualification
FROM	LOCVEC.EMPLOYE E
		INNER JOIN LOCVEC.CONTRAT CT ON (E.cdemp = CT.cdemp)
WHERE	E.cdSx = 1;

--b (SOUS-REQUÊTE IN)

SELECT	nom||' '||prnm AS Employé,
		qualif AS Qualification
FROM	LOCVEC.EMPLOYE
WHERE	cdemp IN   (SELECT  cdemp
                    FROM	LOCVEC.CONTRAT)
		AND cdSx = 1;

--c (SOUS-REQUÊTE EXISTS)

SELECT	E.nom||' '||E.prnm AS Employé,
		E.qualif AS Qualification
FROM	LOCVEC.EMPLOYE E
WHERE	EXISTS (SELECT  NULL
				FROM	LOCVEC.CONTRAT CT
				WHERE	E.cdemp = CT.cdemp)
		AND cdSx = 1;

--R41

SELECT	VE.imtrcl AS Immatriculation,
		ROUND((sysdate - VE.datPMC)/365.25) AS Ancienneté,
		VE.kmactl AS Kilométrage
FROM	LOCVEC.VEHICULE VE
WHERE	EXISTS (SELECT  NULL
                FROM	LOCVEC.MODELE
				WHERE	UPPER(marque) IN ('OPEL', 'RENAULT', 'PEUGEOT')
						AND VE.cdmdl = cdmdl)
		AND EXISTS (SELECT  NULL
                    FROM	LOCVEC.CONTRAT
                    WHERE	VE.cdvhc = cdvhc);

--R42

SELECT  MO.marque||' '||MO.tpmdl AS Modèle,
		CTG.intctg as Catégorie
FROM	LOCVEC.MODELE MO
		INNER JOIN LOCVEC.CATEGORIE CTG ON (MO.cdctg = CTG.cdctg)
WHERE	NOT EXISTS (SELECT  NULL
                    FROM	LOCVEC.VEHICULE
                    WHERE	MO.cdmdl = cdmdl);

--R43

--a (JOINTURES)

SELECT	DISTINCT C.nom||' '||C.prnm AS Client,
		NVL(C.prfs, 'SANS PROFESSION') AS Profession
FROM	LOCVEC.CLIENT C
		INNER JOIN LOCVEC.CONTRAT CT ON (C.cdcli = CT.cdcli)
        INNER JOIN LOCVEC.TYPECONTRAT TPCT ON (CT.cdtpctr = TPCT.cdtpctr)
		INNER JOIN LOCVEC.VEHICULE VE ON (CT.cdvhc = VE.cdvhc)
		INNER JOIN LOCVEC.MODELE MO ON (VE.cdmdl = MO.cdmdl)
		INNER JOIN LOCVEC.CATEGORIE CTG ON (MO.cdctg = CTG.cdctg)
WHERE	UPPER(CTG.intctg) = 'STANDARD'
		AND UPPER(TPCT.inttpctr) = 'STANDARD JOUR + KM';

--b (SOUS-REQUÊTES IN/=)

SELECT	nom||' '||prnm AS Client,
		NVL(prfs, 'SANS PROFESSION') AS Profession
FROM	LOCVEC.CLIENT
WHERE	cdcli IN   (SELECT cdcli
                    FROM   LOCVEC.CONTRAT
                    WHERE  cdvhc IN    (SELECT cdvhc
                                        FROM   LOCVEC.VEHICULE
                                        WHERE  cdmdl IN    (SELECT	cdmdl
                                                            FROM	LOCVEC.MODELE
                                                            WHERE	cdctg IN   (SELECT cdctg
                                                                                FROM   LOCVEC.CATEGORIE
                                                                                WHERE  UPPER(intctg) = 'STANDARD')))
                            AND cdtpctr IN (SELECT  cdtpctr
                                            FROM    LOCVEC.TYPECONTRAT
                                            WHERE   UPPER(inttpctr) = 'STANDARD JOUR + KM'));

--c (SOUS-REQUÊTES EXISTS)

SELECT	C.nom||' '||C.prnm AS Client,
		NVL(C.prfs, 'SANS PROFESSION') AS Profession
FROM	LOCVEC.CLIENT C
WHERE	EXISTS (SELECT  NULL
                FROM    LOCVEC.CONTRAT CT
                WHERE   C.cdcli = CT.cdcli
                        AND EXISTS (SELECT  NULL
                                    FROM    LOCVEC.VEHICULE VE
                                    WHERE   CT.cdvhc = VE.cdvhc
                                            AND EXISTS (SELECT	NULL
                                                        FROM	LOCVEC.MODELE MO
                                                        WHERE	VE.cdmdl = MO.cdmdl
                                                                AND EXISTS (SELECT  NULL
                                                                            FROM    LOCVEC.CATEGORIE
                                                                            WHERE   MO.cdctg = cdctg
                                                                                    AND UPPER(intctg) = 'STANDARD')))
                        AND EXISTS (SELECT  NULL
                                    FROM    LOCVEC.TYPECONTRAT
                                    WHERE   CT.cdtpctr = cdtpctr
                                            AND UPPER(inttpctr) = 'STANDARD JOUR + KM'));

--R44

SELECT	C.nom||' '||C.prnm AS Client
FROM    LOCVEC.CLIENT C
WHERE   NOT EXISTS (SELECT  NULL
                    FROM	LOCVEC.TYPECONTRAT TPCT
                    WHERE	NOT EXISTS (SELECT  NULL
                                        FROM	LOCVEC.CONTRAT
                                        WHERE   TPCT.cdtpctr = cdtpctr
                                                AND C.cdcli = cdcli));
                                        
--R45

SELECT  LEVEL AS "Niveau",
        LPAD(' ', 4*(LEVEL-1))||nom||' '||prnm AS "Employé",
        qualif AS "Qualification"
FROM    LOCVEC.EMPLOYE
CONNECT BY cdsup = PRIOR cdemp
START   WITH cdsup IS NULL
ORDER   BY "Niveau";

--R46

SELECT  LEVEL AS "Niveau",
        LPAD(' ', 4*(LEVEL-1))||nom||' '||prnm AS "Employé",
        qualif AS "Qualification"
FROM    LOCVEC.EMPLOYE
WHERE   datdpt IS NULL
CONNECT BY cdsup = PRIOR cdemp
START   WITH cdsup IS NULL
ORDER   BY "Niveau";

--R47

SELECT  LEVEL AS "Niveau",
        LPAD(' ', 4*(LEVEL-1))||nom||' '||prnm AS "Employé",
        qualif AS "Qualification"
FROM    LOCVEC.EMPLOYE
CONNECT BY cdsup = PRIOR cdemp
START   WITH UPPER(qualif) LIKE 'CHEF D%ATELIER'
ORDER   BY "Niveau";

--R48

SELECT  LEVEL AS "Niveau",
        LPAD(' ', 4*(LEVEL-1))||nom||' '||prnm AS "Employé",
        qualif AS "Qualification"
FROM    LOCVEC.EMPLOYE
WHERE   cdsx = 2
CONNECT BY cdsup = PRIOR cdemp
START   WITH cdsup IS NULL
ORDER   BY "Niveau";

--R49

SELECT  LEVEL AS "Niveau",
        LPAD(' ', 4*(LEVEL-1))||nom||' '||prnm AS "Employé",
        qualif AS "Qualification"
FROM    LOCVEC.EMPLOYE
WHERE   datdpt IS NULL
        AND UPPER(qualif) != 'DIRECTEUR'
        AND cdemp NOT IN   (SELECT  cdemp
                            FROM    LOCVEC.EMPLOYE
                            CONNECT BY cdsup = PRIOR cdemp
                            START   WITH UPPER(qualif) LIKE 'CHEF D%ATELIER')
CONNECT BY cdsup = PRIOR cdemp
START   WITH cdsup IS NULL
ORDER   BY "Niveau";

--R50

SELECT  LPAD(' ', 4*(LEVEL-1))||nom AS "Employé",
        cdsup AS "CDSUP",
        PRIOR nom AS "Nom Parent",
        CONNECT_BY_ISLEAF AS "Noeud",
        CONNECT_BY_ROOT(nom) AS "Racine",
        SYS_CONNECT_BY_PATH(cdemp,':') AS "Chemin"
FROM    LOCVEC.EMPLOYE
CONNECT BY cdsup = PRIOR cdemp
START   WITH cdsup IS NULL
ORDER   SIBLINGS BY nom;






