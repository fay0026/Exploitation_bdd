--FAY Damien Inf-S2 TP5B

DROP TABLE PARTICIPATION CASCADE CONSTRAINTS;

--Exercice 1

--a

CREATE TABLE PARTICIPATION AS (
    SELECT  cdcompet, 
            cdpers AS cdmemb, 
            dateregltcompet
    FROM    MINIGOLF.PARTICIPER
    ) ;
    
--b

ALTER TABLE PARTICIPATION ADD (
    CONSTRAINT pk_constraint PRIMARY KEY (cdcompet, cdmemb),
    CONSTRAINT fk_constraint_cdcompet FOREIGN KEY (cdcompet) REFERENCES competition(cdcompet),
    CONSTRAINT fk_constraint_dateregltcompet FOREIGN KEY (cdmemb) REFERENCES membre(cdmemb));
    
--c

ALTER TABLE PARTICIPATION
    ADD resultatobt NUMBER
    ADD CONSTRAINT resultatobt_range CHECK (resultatobt > 0 AND resultatobt < 36);
    
--d

UPDATE PARTICIPATION
    SET     resultatobt = 40
    WHERE   UPPER(cdmemb) = 'M005'
            AND UPPER(cdcompet) = 'C001' OR UPPER(cdcompet) = 'C002';
            
--Npus avons un problème d'insertion car 40 est plus grand que 36, qui est le
--maximum défini pour resultatobt par la contrainte.

UPDATE PARTICIPATION
    SET     resultatobt = 30
    WHERE   UPPER(cdmemb) = 'M005'
            AND (UPPER(cdcompet) = 'C001' OR UPPER(cdcompet) = 'C002');

--e

DELETE FROM PARTICIPATION
    WHERE participation.dateregltcompet is Null;

























